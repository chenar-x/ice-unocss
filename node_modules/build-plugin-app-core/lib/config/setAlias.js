"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var path = require("path");
var constant_1 = require("../constant");
exports.default = (function (api, options) {
    var onGetWebpackConfig = api.onGetWebpackConfig, context = api.context, getValue = api.getValue;
    var alias = options.alias, framework = options.framework;
    var rootDir = context.rootDir;
    var tempPath = getValue(constant_1.TEMP_PATH);
    var aliasMap = [
        [alias + "$", path.join(tempPath, 'index.ts')],
        ["" + alias, path.join(tempPath, 'pages')],
        ['@', path.join(rootDir, 'src')],
        // add alias for modular import
        ["$$" + alias, tempPath],
        ['$$framework', tempPath],
    ];
    onGetWebpackConfig(function (config) {
        // eslint-disable-next-line
        aliasMap.forEach(function (alias) {
            var hasAlias = config.resolve.alias.has(alias[0]);
            if (!hasAlias) {
                config.resolve.alias.set(alias[0], alias[1]);
            }
        });
        // add alias of basic dependencies
        var basicDependencies = [];
        if (framework === 'react') {
            basicDependencies = [
                ['react', rootDir],
                ['react-dom', rootDir]
            ];
        }
        else if (framework === 'rax') {
            basicDependencies = [
                ['rax', rootDir]
            ];
        }
        basicDependencies.forEach(function (dep) {
            var _a = Array.isArray(dep) ? dep : [dep], depName = _a[0], searchFolder = _a[1];
            var aliasPath = searchFolder
                ? require.resolve(depName, { paths: [searchFolder] })
                : require.resolve(depName);
            config.resolve.alias.set(depName, path.dirname(aliasPath));
        });
    });
});
//# sourceMappingURL=setAlias.js.map