"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ts = require("typescript");
var chalk = require("chalk");
var os = require("os");
var code_frame_1 = require("@babel/code-frame");
var createFrame = function (_a) {
    var source = _a.source, location = _a.location;
    var frame = (0, code_frame_1.codeFrameColumns)(source, location, {
        forceColor: true,
    })
        .split('\n')
        .map(function (line) { return "  " + line; })
        .join(os.EOL);
    return frame;
};
var formatDiagnosticMessage = function (diagnostic) {
    var _a, _b, _c, _d;
    var message = ts.flattenDiagnosticMessageText(diagnostic.messageText, os.EOL);
    var loc;
    var pos = diagnostic.start === undefined ? null : (_a = diagnostic.file) === null || _a === void 0 ? void 0 : _a.getLineAndCharacterOfPosition(diagnostic.start);
    if (pos && diagnostic.file && typeof diagnostic.start === 'number' && typeof diagnostic.length === 'number') {
        var _e = (_b = diagnostic.file) === null || _b === void 0 ? void 0 : _b.getLineAndCharacterOfPosition(diagnostic.start), startLine = _e.line, startCharacter = _e.character;
        var _f = (_c = diagnostic.file) === null || _c === void 0 ? void 0 : _c.getLineAndCharacterOfPosition(diagnostic.start + diagnostic.length), endLine = _f.line, endCharacter = _f.character;
        loc = {
            start: {
                line: startLine + 1, column: startCharacter + 1,
            },
            end: {
                line: endLine + 1, column: endCharacter + 1,
            }
        };
    }
    var errorLabel = chalk.red('error');
    var position = loc
        ? chalk.yellow(loc.start.line) + ":" + chalk.yellow(loc.start.column)
        : '';
    return [
        "" + os.EOL + chalk.cyan((_d = diagnostic.file) === null || _d === void 0 ? void 0 : _d.fileName) + ":" + position,
        errorLabel + ": " + message,
        "" + (loc ? createFrame({ source: diagnostic.file.text, location: loc }) : ''),
    ].join(os.EOL);
};
exports.default = formatDiagnosticMessage;
//# sourceMappingURL=formatDiagnosticMessage.js.map